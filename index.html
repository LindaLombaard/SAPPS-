<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">

<title>SA Private Protection Services</title>

<style>
  :root{
    --brand:#ff7b00;
    --black:#111;
    --white:#fff;
    --nav-height:64px;
  }

  *{box-sizing:border-box}
  html{scroll-behavior:smooth}
  body{
    margin:0;
    font-family:"Montserrat",sans-serif;
    color:#222;
    background:#fff;
  }

  /* ---------- NAV ---------- */
  nav{
    position:fixed;
    top:0;
    left:0;
    right:0;
    height:var(--nav-height);
    background:rgba(17,17,17,0.95);
    display:flex;
    align-items:center;
    z-index:2200; /* keep nav above most content */
    padding:0 18px;
    box-shadow:0 1px 0 rgba(255,255,255,0.03) inset;
    gap:12px;
    justify-content:space-between;
  }

  /* brand/logo area */
  .nav-brand{ display:flex; align-items:center; gap:12px; }
  .nav-brand a{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width:44px;
    height:32px;
    border-radius:6px;
    background:var(--brand); /* orange fallback so block is visible */
    overflow:hidden;
    text-decoration:none;
  }
  .nav-brand svg{ width:28px; height:28px; display:block; }

  /* nav list (default horizontal) */
  nav ul{
    list-style:none;
    margin:0;
    padding:0;
    display:flex;
    gap:18px;
    align-items:center;
    width:100%;
    justify-content:center;
  }

  nav li{position:relative}
  nav a{
    color:var(--white);
    text-decoration:none;
    padding:10px 14px;
    display:inline-block;
    font-weight:600;
    border-radius:4px;
  }
  nav a:hover{background:rgba(255,255,255,0.06)}
  nav a.active{
    background:var(--brand);
    color:#fff;
  }

  /* submenu: make it behave like mobile (static) so it opens inline inside the menu overlay */
  .submenu{
    display:none;
    position:static; /* important: static so it flows in the menu overlay */
    background:transparent;
    border-radius:0;
    min-width:0;
    flex-direction:column;
    padding:0;
    box-shadow:none;
  }
  .submenu.open{ display:flex; }

  .submenu li{padding:0}
  .submenu li a{padding:10px 16px; width:100%; display:block; color:var(--white)}
  .submenu li a:hover{background:rgba(255,255,255,0.04)}

  /* ---------- HERO ---------- */
  .hero {
    height: min(80vh, 780px);
    min-height: 40vh;
    background: url('images/sapps-banner-1.png') center/cover no-repeat;
    background-size: cover;
    background-position: center;
    background-attachment: scroll;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    margin-top: var(--nav-height);
    text-align: center;
    overflow: hidden;
  }

  .hero-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.35);
    transition: background .25s linear;
    z-index: 1;
    pointer-events: none;
  }

  .hero .content {
    position: relative;
    z-index: 2;
    padding: 0 20px;
    text-align: center;
    max-width: 920px;
  }

  .hero h1 {
    margin:0 0 8px 0;
    font-weight:800;
    color:#fff;
    line-height:1.02;
    font-size: clamp(1.6rem, 6vw, 3.2rem);
  }
  .hero p {
    margin:0;
    font-size: clamp(.9rem, 2.4vw, 1.05rem);
    opacity:0.95;
  }

  /* sections base */
  main{max-width:1200px; margin:0 auto; padding:48px 18px}
  h2.section-title{color:var(--brand); font-size:1.6rem; margin:18px 0 20px; text-align:left}
  section{margin:40px 0; opacity:0; transform:translateY(30px); transition:all .7s ease-out; scroll-margin-top:calc(var(--nav-height) + 12px)}
  section.visible{opacity:1; transform:none}

  /* ---------- SERVICES (cards) ---------- */
  .services-wrap{padding:12px 18px}
  .services-grid{
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:22px;
    align-items:start;
  }

  .service-card{
    background:#fff;
    border-radius:10px;
    box-shadow:0 6px 18px rgba(0,0,0,0.06);
    overflow:hidden;
    display:flex;
    flex-direction:column;
    text-decoration:none;
    transition:transform .25s ease, box-shadow .25s ease;
  }

  .service-card:hover{transform:translateY(-8px); box-shadow:0 18px 36px rgba(0,0,0,0.12)}
  .service-image{height:160px; width:100%; object-fit:cover; display:block}
  .service-body{padding:20px; text-align:center; flex:1; display:flex; align-items:center; justify-content:center}
  .service-body h3{margin:0; font-size:1rem; color:#111}

  /* ---------- PACKAGES ---------- */
  .packages-grid{
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:22px;
    align-items:stretch;
    justify-items:center;
  }
  .package-card{
    width:220px;
    background:#fff;
    border-radius:10px;
    padding:18px;
    box-shadow:0 6px 18px rgba(0,0,0,0.06);
    text-align:center;
    transition:transform .2s ease;
    text-decoration:none;
    color:#111;
  }
  .package-card:hover{transform:translateY(-6px)}
  .package-card .price{margin-top:10px; color:#555; font-size:.95rem}

  /* ---------- GALLERY (masonry-like) ---------- */
  .gallery-grid{
    column-gap:18px;
    column-count:4;
    z-index: 0;
    position: relative;
  }
  .gallery-grid img{
    width:100%;
    display:block;
    margin-bottom:14px;
    border-radius:10px;
    box-shadow:0 6px 18px rgba(0,0,0,0.06);
    cursor:pointer;
    height:auto;
    z-index:1;
    position:relative;
    pointer-events:auto;
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    transform: translateZ(0);
  }
  .gallery-grid img:hover{opacity:0.9}

  /* smaller columns on tablets/phones */
  @media (max-width:1200px){ .services-grid{grid-template-columns:repeat(3,1fr)} .gallery-grid{column-count:3} }
  @media (max-width:900px){ .services-grid{grid-template-columns:repeat(2,1fr)} .packages-grid{grid-template-columns:repeat(2,1fr)} .gallery-grid{column-count:2} .hero h1{font-size:2.2rem} }
  @media (max-width:520px){
    .services-grid{grid-template-columns:1fr}
    .packages-grid{grid-template-columns:1fr}
    .gallery-grid{column-count:1}
    .hero{height:55vh}
    .nav-brand a { width:36px; height:28px; }
  }

  /* floating social */
  .floating-buttons{position:fixed; right:18px; bottom:20px; display:flex; flex-direction:column; gap:12px; z-index:1300}
  .float-btn{width:44px; height:44px; border-radius:50%; display:flex; align-items:center; justify-content:center; box-shadow:0 6px 18px rgba(0,0,0,0.15); transition:transform .18s ease}
  .float-btn img{width:22px;height:22px; display:block}
  .float-btn:hover{transform:translateY(-5px)}
  .float-btn.whatsapp{background:#25D366}
  .float-btn.facebook{background:#1877F2}
  .float-btn.tiktok{background:#000; border:2px solid #ff0050}
  .float-btn.linkedin{background:#0A66C2}

  /* small helper */
  .section-head{display:flex; align-items:center; gap:16px; justify-content:space-between}

  /* ---------- MOBILE / OVERLAY MENU behaviour for all viewports ----------
     Make the mobile-style overlay menu available on all screen sizes.
     - nav-toggle is visible on all sizes (so user can open the overlay)
     - when #navLinks has .open it becomes a full-screen vertical overlay (same as mobile)
     -------------------------------------------------------------------- */

  /* show hamburger toggle for all viewports so desktop can open the overlay menu */
  .nav-toggle {
    display:flex;
    background:transparent;
    border:0;
    cursor:pointer;
    gap:6px;
    padding:8px;
    align-items:center;
    justify-content:center;
  }
  .nav-toggle .bar{ display:block; width:22px; height:2px; background:var(--white); border-radius:2px; transition:transform .25s, opacity .25s; }

  /* default (non-open) nav menu remains horizontal; when opened, become overlay */
  nav ul.open {
    position:fixed;
    top:var(--nav-height);
    left:0;
    right:0;
    bottom:0;
    background:rgba(17,17,17,0.98);
    flex-direction:column;
    align-items:stretch;
    gap:0;
    padding:12px 0;
    overflow:auto;
    transform:none;
    transition:none;
    z-index:2150;
  }
  /* overlay list items */
  nav ul.open > li { width:100%; border-top:1px solid rgba(255,255,255,0.03); }
  nav ul.open a { display:block; width:100%; text-align:left; padding:14px 18px; }

  /* when overlay is open, submenu should be static and visible when .open */
  nav ul.open .submenu { position:static; background:transparent; box-shadow:none; padding-left:10px; display:none; }
  nav ul.open .submenu.open { display:flex; flex-direction:column; }

  /* submenu toggle button (visible within overlay and on desktop) */
  .submenu-toggle { display:inline-flex; align-items:center; justify-content:center; padding:10px; margin-left:auto; background:transparent; border:0; color:var(--white); cursor:pointer; }
  /* small visual for open submenu (keyboard focus/indicator) */
  nav li.submenu-open > a { background:rgba(255,255,255,0.04); }

  /* lightbox tweaks */
  .lightbox { display:none; z-index:9999; }
  .lightbox .lightbox-content { max-width:92%; max-height:78%; }

</style>
</head>
<body>

  <!-- NAV -->
  <nav id="mainNav" aria-label="Main navigation">
    <div class="nav-brand" aria-hidden="false">
      <a href="#home" class="logo" aria-label="Home">
        <svg viewBox="0 0 100 100" role="img" aria-labelledby="logoTitle" xmlns="http://www.w3.org/2000/svg">
          <title id="logoTitle">SA Private Protection Services</title>
          <rect x="6" y="6" width="88" height="88" rx="12" ry="12" fill="#ff7b00"/>
          <path d="M50 22 L65 62 L50 50 L35 62 Z" fill="#111"/>
        </svg>
        <img src="images/logo.png" alt="SA Private Protection Services Logo" style="width:0;height:0;position:absolute;opacity:0;" onload="this.style.display='none'">
      </a>
    </div>

    <button class="nav-toggle" id="navToggle" aria-expanded="false" aria-label="Open menu">
      <span class="bar"></span>
      <span class="bar"></span>
      <span class="bar"></span>
    </button>

    <ul id="navLinks" role="menubar" aria-label="Primary">
      <li><a href="#home" class="nav-link">Home</a></li>
      <li><a href="#about" class="nav-link">About</a></li>
      <li class="has-submenu" role="none">
        <a href="#services" class="nav-link" aria-haspopup="true" aria-expanded="false" role="menuitem">Our Services</a>
        <button class="submenu-toggle" aria-expanded="false" aria-label="Toggle Our Services submenu">▾</button>
        <ul class="submenu" aria-label="Our Services submenu" role="menu">
          <li role="none"><a href="#armed-response" class="nav-link" role="menuitem">24-Hour Armed Response</a></li>
          <li role="none"><a href="#close-protection" class="nav-link" role="menuitem">Close Protection Services</a></li>
          <li role="none"><a href="#guarding" class="nav-link" role="menuitem">Guarding Services</a></li>
          <li role="none"><a href="#escorts" class="nav-link" role="menuitem">Escorts & Transfers</a></li>
          <li role="none"><a href="#event-security" class="nav-link" role="menuitem">Event Security</a></li>
          <li role="none"><a href="#surveillance" class="nav-link" role="menuitem">Surveillance & Monitoring</a></li>
        </ul>
      </li>
      <li class="has-submenu" role="none">
        <a href="#packages" class="nav-link" aria-haspopup="true" aria-expanded="false" role="menuitem">Response Packages</a>
        <button class="submenu-toggle" aria-expanded="false" aria-label="Toggle Response Packages submenu">▾</button>
        <ul class="submenu" aria-label="Response Packages submenu" role="menu">
          <li role="none"><a href="#residential" class="nav-link" role="menuitem">Residential</a></li>
          <li role="none"><a href="#pensioner" class="nav-link" role="menuitem">Pensioner</a></li>
          <li role="none"><a href="#small-business" class="nav-link" role="menuitem">Small Business</a></li>
          <li role="none"><a href="#large-business" class="nav-link" role="menuitem">Large Business</a></li>
        </ul>
      </li>
      <li><a href="#gallery" class="nav-link">Gallery</a></li>
      <li><a href="#contact" class="nav-link">Contact</a></li>
    </ul>
  </nav>

  <!-- HERO -->
  <header id="home" class="hero" role="banner">
    <div class="hero-overlay" id="heroOverlay"></div>
    <div class="content">
      <h1>SA Private Protection Services</h1>
      <p>Professional security solutions — responsive and trusted since 2016.</p>
    </div>
  </header>

  <main>

    <!-- ABOUT -->
    <section id="about" class="about-section">
      <div class="section-head">
        <h2 class="section-title">About Us</h2>
      </div>
       <p>Established in 2016, SA Private Protection Services (Pty) Ltd has consistently delivered high-quality security solutions to a growing client base. With a proven track record of retaining clients and expanding our expertise, we pride ourselves on mastering the art of client satisfaction. Our flat corporate structure ensures seamless communication and flexibility, allowing us to adapt to your evolving security needs.</p>

  <p>SA Private Protection Services has established itself as a trusted security partner for some of South Africa's largest retailers. We provide tailored security solutions to prominent food retailers, liquor chains, and clothing franchises, ensuring the safety and security of the people, premises, and assets.</p>

  <p>Our expertise in risk management, surveillance, and armed response enables us to mitigate potential threats and protect our clients' interests. With a proven track record of delivering high-quality security services, SA Private Protection Services is the partner of choice for businesses seeking to safeguard their operations.</p>
</section>

    <!-- SERVICES GRID (cards clickable to anchors) -->
    <section id="services" class="services-wrap">
      <h2 class="section-title">Our Services</h2>

      <div class="services-grid">
        <a id="armed-response" class="service-card" href="armed-response-details.html" title="24-Hour Armed Response">
          <img class="service-image" src="images/service1.jpg" alt="24-Hour Armed Response">
          <div class="service-body"><h3>24-Hour Armed Response</h3></div>
        </a>

        <a id="close-protection" class="service-card" href="close-protection-details.html" title="Close Protection Services">
          <img class="service-image" src="images/service2.jpg" alt="Close Protection Services">
          <div class="service-body"><h3>Close Protection Services</h3></div>
        </a>

        <a id="guarding" class="service-card" href="security-services-details.html" title="Guarding Services">
          <img class="service-image" src="images/service3.jpg" alt="Guarding Services">
          <div class="service-body"><h3>Guarding Services</h3></div>
        </a>

        <a id="escorts" class="service-card" href="escort-details.html" title="Escorts & Transfers">
          <img class="service-image" src="images/service5.jpg" alt="Escorts & Transfers">
          <div class="service-body"><h3>Escorts & Transfers</h3></div>
        </a>

        <a id="event-security" class="service-card" href="event-security-details.html" title="Event Security">
          <img class="service-image" src="images/gallery2.jpg" alt="Event Security">
          <div class="service-body"><h3>Event Security</h3></div>
        </a>

        <a id="surveillance" class="service-card" href="surveillance-alarm-details.html" title="Surveillance & Monitoring">
          <img class="service-image" src="images/gallery11.jpg" alt="Surveillance & Monitoring">
          <div class="service-body"><h3>Surveillance & Monitoring</h3></div>
        </a>

      </div>
    </section>

    <!-- PACKAGES -->
    <section id="packages">
      <h2 class="section-title">Response Packages</h2>
      <div class="packages-grid" style="margin-top:18px;">
        <a id="residential" class="package-card" href="#residential">
          <strong>Residential</strong>
          <div class="price">R345.00 Per Month</div>
        </a>
        <a id="pensioner" class="package-card" href="#pensioner">
          <strong>Pensioner</strong>
          <div class="price">R172.50 Per Month</div>
        </a>
        <a id="small-business" class="package-card" href="#small-business">
          <strong>Small Business</strong>
          <div class="price">R448.50 Per Month</div>
        </a>
        <a id="large-business" class="package-card" href="#large-business">
          <strong>Large Business</strong>
          <div class="price">R678.50 Per Month</div>
        </a>
      </div>
    </section>

    <!-- GALLERY -->
<section id="gallery">
  <h2 class="section-title">Gallery</h2>
  <div class="gallery-grid" id="galleryGrid">
    <img src="images/gallery17.jpg" alt="Gallery 17" class="lightbox-img">
    <img src="images/gallery2.jpg" alt="Gallery 2" class="lightbox-img">
    <img src="images/gallery3.jpg" alt="Gallery 3" class="lightbox-img">
    <img src="images/gallery4.jpg" alt="Gallery 4" class="lightbox-img">
    <img src="images/gallery18.jpg" alt="Gallery 18" class="lightbox-img">
    <img src="images/gallery6.jpg" alt="Gallery 6" class="lightbox-img">
    <img src="images/gallery7.jpg" alt="Gallery 7" class="lightbox-img">
    <img src="images/gallery8.jpg" alt="Gallery 8" class="lightbox-img">
    <img src="images/gallery9.jpg" alt="Gallery 9" class="lightbox-img">
    <img src="images/gallery10.jpg" alt="Gallery 10" class="lightbox-img">
    <img src="images/gallery11.jpg" alt="Gallery 11" class="lightbox-img">
    <img src="images/gallery12.jpg" alt="Gallery 12" class="lightbox-img">
    <img src="images/gallery13.jpg" alt="Gallery 13" class="lightbox-img">
    <img src="images/gallery14.jpg" alt="Gallery 14" class="lightbox-img">
    <img src="images/gallery15.jpg" alt="Gallery 15" class="lightbox-img">
    <img src="images/gallery16.jpg" alt="Gallery 16" class="lightbox-img">
  </div>
</section>

<!-- LIGHTBOX -->
<div id="lightbox" class="lightbox" aria-hidden="true" role="dialog" aria-label="Image viewer">
  <span class="close" role="button" aria-label="Close">&times;</span>
  <img class="lightbox-content" id="lightbox-img" alt="">
  <div id="caption"></div>
  <a class="prev" role="button" aria-label="Previous image">&#10094;</a>
  <a class="next" role="button" aria-label="Next image">&#10095;</a>
</div>

<!-- CONTACT -->
<section id="contact">
  <h2>Contact Us</h2>

  <div class="contact-container">
    <div class="contact-details">
      <p><strong>Office:</strong> <a href="tel:0100060366">010 006 0366</a></p>
      <p><strong>Director - Jaco Human:</strong> <a href="tel:0732105102">073 210 5102</a></p>
      <p><strong>HR & Accounts - Natasha Kok:</strong> <a href="tel:0838801768">083 880 1768</a></p>
      <p><strong>Email:</strong>
        <a href="mailto:jhuman@sapps.co.za">jhuman@sapps.co.za</a> |
        <a href="mailto:admin@sapps.co.za">admin@sapps.co.za</a>
      </p>
      <p><strong>Address:</strong> 51 Vaal Drive, Pietersfield Ext, Springs, 1559</p>

      <div class="office-hours">
        <h3>Office Hours</h3>
        <p>Monday - Thursday: 08:00 AM - 04:00 PM</p>
        <p>Friday: 08:00 AM - 02:00 PM</p>
        <p>Sunday & Public Holidays: Closed</p>
      </div>
    </div>

    <div class="contact-form">
      <h3>Send Us a Message</h3>
      <form id="contactForm">
        <input type="text" name="name" placeholder="Your Name" required>
        <input type="email" name="email" placeholder="Your Email" required>
        <input type="tel" name="phone" placeholder="Your Phone Number">
        <textarea name="message" placeholder="Your Message" rows="5" required></textarea>
        <button type="submit">Send Message</button>
      </form>

      <div id="thankYouMessage" style="display:none; color: green; margin-top: 20px;">
        ✅ Thanks for your message! We'll be in touch soon.
      </div>
    </div>

  </div>
</section>

<footer style="background:#111;color:#fff;padding:28px;text-align:center">© 2025 SA Private Protection Services (PTY) LTD</footer>

<!-- Floating social buttons -->
<div class="floating-buttons" aria-hidden="false">
  <a class="float-btn whatsapp" href="https://wa.me/27732105102" target="_blank" rel="noopener noreferrer" aria-label="WhatsApp">
    <img src="images/logo-whatsapp.png" alt="WhatsApp">
  </a>
  <a class="float-btn facebook" href="https://www.facebook.com/sa-private-protection-services" target="_blank" rel="noopener noreferrer" aria-label="Facebook">
    <img src="images/Facebook Logo.png" alt="Facebook">
  </a>
  <a class="float-btn tiktok" href="https://www.tiktok.com/@saprivateprotection" target="_blank" rel="noopener noreferrer" aria-label="TikTok">
    <img src="images/logo-tiktok.png" alt="TikTok">
  </a>
  <a class="float-btn linkedin" href="https://www.linkedin.com/in/sa-private-protection-services" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
    <img src="images/linkedin logo.png" alt="LinkedIn">
  </a>
</div>

<script>
/* =========================
   LIGHTBOX
   ========================= */
(function() {
  const lightbox = document.getElementById('lightbox');
  const lightboxImg = document.getElementById('lightbox-img');
  const captionText = document.getElementById('caption');
  const images = Array.from(document.querySelectorAll('.lightbox-img'));
  let currentIndex = 0;

  function showImage(index) {
    if(index < 0 || index >= images.length) return;
    currentIndex = index;
    const img = images[index];
    lightboxImg.src = img.src;
    lightboxImg.alt = img.alt || '';
    captionText.innerHTML = img.alt || '';
    lightbox.style.display = 'block';
    lightbox.setAttribute('aria-hidden', 'false');
    document.documentElement.style.overflow = 'hidden';
    document.body.style.overflow = 'hidden';
  }

  images.forEach((img, index) => {
    img.style.pointerEvents = 'auto';
    img.addEventListener('click', () => showImage(index));
    img.setAttribute('tabindex','0');
    img.addEventListener('keydown', (ev) => {
      if(ev.key === 'Enter' || ev.key === ' ') {
        ev.preventDefault();
        showImage(index);
      }
    });
  });

  document.querySelector('.next').onclick = () => showImage((currentIndex + 1) % images.length);
  document.querySelector('.prev').onclick = () => showImage((currentIndex - 1 + images.length) % images.length);
  document.querySelector('.close').onclick = closeLightbox;
  function closeLightbox(){
    lightbox.style.display = 'none';
    lightbox.setAttribute('aria-hidden', 'true');
    document.documentElement.style.overflow = '';
    document.body.style.overflow = '';
  }
  lightbox.addEventListener('click', (e) => { if(e.target === lightbox) closeLightbox(); });
  document.addEventListener('keydown', (e) => {
    if(lightbox.style.display === 'block') {
      if(e.key === 'ArrowRight') document.querySelector('.next').click();
      if(e.key === 'ArrowLeft') document.querySelector('.prev').click();
      if(e.key === 'Escape') closeLightbox();
    }
  });
})();

/* =========================
   NAV BEHAVIOUR & SMOOTH SCROLL
   - overlay menu (mobile-style) available on ALL viewports
   - first click opens submenu, second click follows
   - explicit ▾ toggles work
   - clicking outside closes everything
   ========================= */
(function(){
  const nav = document.getElementById('mainNav');
  const navLinks = document.getElementById('navLinks');
  const navToggle = document.getElementById('navToggle');
  const heroOverlay = document.getElementById('heroOverlay');

  // nav toggle opens the overlay menu on any screen size
  navToggle.addEventListener('click', () => {
    const expanded = navToggle.getAttribute('aria-expanded') === 'true';
    navToggle.setAttribute('aria-expanded', String(!expanded));
    navLinks.classList.toggle('open');
    navToggle.classList.toggle('active');
  });

  // close overlay when a normal link is clicked
  navLinks.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', (e) => {
      if(navLinks.classList.contains('open')) {
        navLinks.classList.remove('open');
        navToggle.classList.remove('active');
        navToggle.setAttribute('aria-expanded', 'false');
      }
    });
  });

  // submenu toggles and unified pointer behavior
  document.querySelectorAll('.has-submenu').forEach(li => {
    const button = li.querySelector('.submenu-toggle');
    const submenu = li.querySelector('ul.submenu');
    const anchor = li.querySelector('a.nav-link');

    if (button && submenu) {
      button.addEventListener('click', (e) => {
        e.preventDefault();
        const isOpen = submenu.classList.toggle('open');
        button.setAttribute('aria-expanded', String(isOpen));
        anchor.setAttribute('aria-expanded', String(isOpen));
        if (isOpen) li.classList.add('submenu-open');
        else li.classList.remove('submenu-open');
      });
    }

    if (anchor && submenu) {
      anchor.addEventListener('pointerdown', (ev) => {
        const isOpen = submenu.classList.contains('open') || li.classList.contains('submenu-open');
        if (!isOpen) {
          ev.preventDefault();
          // open overlay if not already open (so desktop uses mobile overlay behavior)
          if(!navLinks.classList.contains('open')) {
            navLinks.classList.add('open');
            navToggle.classList.add('active');
            navToggle.setAttribute('aria-expanded','true');
          }
          closeAllSubmenus();
          submenu.classList.add('open');
          li.classList.add('submenu-open');
          const btn = li.querySelector('.submenu-toggle');
          if (btn) btn.setAttribute('aria-expanded', 'true');
          anchor.setAttribute('aria-expanded', 'true');
        } else {
          setTimeout(() => {
            submenu.classList.remove('open');
            li.classList.remove('submenu-open');
            const btn = li.querySelector('.submenu-toggle');
            if (btn) btn.setAttribute('aria-expanded', 'false');
            anchor.setAttribute('aria-expanded', 'false');
          }, 600);
        }
      });

      // keyboard support
      anchor.addEventListener('keydown', (ev) => {
        if (ev.key === 'Enter' || ev.key === ' ') {
          ev.preventDefault();
          const isOpen = submenu.classList.contains('open') || li.classList.contains('submenu-open');
          if (!isOpen) {
            if(!navLinks.classList.contains('open')) {
              navLinks.classList.add('open');
              navToggle.classList.add('active');
              navToggle.setAttribute('aria-expanded','true');
            }
            closeAllSubmenus();
            submenu.classList.add('open');
            li.classList.add('submenu-open');
            const btn = li.querySelector('.submenu-toggle');
            if (btn) btn.setAttribute('aria-expanded', 'true');
            anchor.setAttribute('aria-expanded', 'true');
          } else {
            window.location.href = anchor.href;
          }
        }
      });
    }
  });

  function closeAllSubmenus() {
    document.querySelectorAll('.has-submenu').forEach(li => {
      const submenu = li.querySelector('ul.submenu');
      if (submenu) submenu.classList.remove('open');
      li.classList.remove('submenu-open');
      const btn = li.querySelector('.submenu-toggle');
      if (btn) btn.setAttribute('aria-expanded', 'false');
      const anchor = li.querySelector('a.nav-link');
      if (anchor) anchor.setAttribute('aria-expanded', 'false');
    });
  }

  // clicking outside closes menus
  document.addEventListener('click', (e) => {
    if (!nav.contains(e.target)) {
      closeAllSubmenus();
      if (navLinks.classList.contains('open')) {
        navLinks.classList.remove('open');
        navToggle.classList.remove('active');
        navToggle.setAttribute('aria-expanded', 'false');
      }
    }
  });

  // smooth scroll handler with offset + close menus
  (function(){
    const navHeightRaw = getComputedStyle(document.documentElement).getPropertyValue('--nav-height');
    const NAV_HEIGHT = navHeightRaw ? parseInt(navHeightRaw, 10) : 64;

    function scrollToIdWithOffset(hash) {
      if(!hash) return false;
      const id = hash.replace('#','');
      const target = document.getElementById(id);
      if(!target) return false;
      const rect = target.getBoundingClientRect();
      const scrollTop = window.scrollY + rect.top - NAV_HEIGHT - 8; // small gap
      window.scrollTo({ top: Math.max(scrollTop, 0), behavior: 'smooth' });
      return true;
    }

    document.querySelectorAll('nav a[href^="#"], #navLinks a[href^="#"]').forEach(a => {
      a.addEventListener('click', function(e){
        const href = this.getAttribute('href');
        if(href && href.startsWith('#')) {
          const handled = scrollToIdWithOffset(href);
          // close overlay & submenus
          if(navLinks.classList.contains('open')) {
            navLinks.classList.remove('open');
            navToggle.classList.remove('active');
            navToggle.setAttribute('aria-expanded','false');
          }
          closeAllSubmenus();
          if(handled) {
            e.preventDefault();
            history.replaceState(null, '', href);
          }
        }
      }, {passive:false});
    });

    window.addEventListener('load', () => {
      if(location.hash){
        setTimeout(() => scrollToIdWithOffset(location.hash), 60);
      }
    });
  })();

})();
</script>

</body>
</html>